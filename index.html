<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patchcoin Claims</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #2563eb;
            --success-color: #16a34a;
            --background-color: #f8f9fa;
            --card-background: #ffffff;
            --border-color: #e5e7eb;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--background-color);
            color: var(--text-primary);
            line-height: 1.5;
            padding: 1rem;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        .card {
            background: var(--card-background);
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        h1, h2 {
            text-align: center;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
        }
        h1 {
            font-size: 1.875rem;
            font-weight: 700;
        }
        h2 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        #chartContainer {
            position: relative;
            height: 400px;
            width: 100%;
            margin-bottom: 2rem;
        }
        .progress-container {
            margin-top: 2rem;
        }
        .progress-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .progress-value {
            font-weight: 600;
        }
        .progress-eligible {
            color: var(--primary-color);
        }
        .progress-received {
            color: var(--success-color);
        }
        .progress {
            background: #e9ecef;
            border-radius: 9999px;
            overflow: hidden;
            height: 1rem;
            margin-bottom: 1.5rem;
        }
        .progress-bar {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 9999px;
        }
        #capProgressEligible {
            background: var(--primary-color);
        }
        #capProgressReceived {
            background: var(--success-color);
        }
        .progress-subtitle {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-align: right;
            margin-top: 0.25rem;
        }
        .chart-tooltip {
            background: var(--card-background);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            font-size: 0.875rem;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table th, table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            text-align: left;
        }
        table th {
            background: var(--card-background);
            font-weight: 600;
        }
        table tbody tr:hover {
            background-color: #f1f5f9;
        }
        .truncate {
            max-width: 150px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        th.amount, td.amount {
            text-align: right;
        }
        input[type="text"] {
            margin-bottom: 1rem;
            padding: 0.5rem;
            width: 100%;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }
        @media (max-width: 768px) {
            #chartContainer {
                height: 300px;
            }
        }
        @media (max-width: 480px) {
            #chartContainer {
                height: 250px;
            }
            table th, table td {
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="card">
        <h1>Patchcoin Claims</h1>
        <div id="chartContainer">
            <canvas id="claimsChart"></canvas>
        </div>
        <div class="progress-container">
            <div class="progress-group">
                <div class="progress-label">
                    <span>Eligible Progress</span>
                    <span class="progress-value progress-eligible" id="eligiblePercent">0%</span>
                </div>
                <div class="progress">
                    <div id="capProgressEligible" class="progress-bar"></div>
                </div>
                <div class="progress-subtitle" id="eligibleSubtitle">0 / 21,000,000</div>
            </div>
            <div class="progress-group">
                <div class="progress-label">
                    <span>Received Progress</span>
                    <span class="progress-value progress-received" id="receivedPercent">0%</span>
                </div>
                <div class="progress">
                    <div id="capProgressReceived" class="progress-bar"></div>
                </div>
                <div class="progress-subtitle" id="receivedSubtitle">0 / 21,000,000</div>
            </div>
        </div>
    </div>
    <div class="card">
        <h2>Claims Data</h2>
        <input type="text" id="claimsSearch" placeholder="Search claims...">
        <table id="claimsTable">
            <thead>
            <tr>
                <th>Peercoin Address</th>
                <th>Patchcoin Address</th>
                <th class="amount">Peercoin Balance</th>
                <th class="amount">Patchcoin Eligible</th>
                <th class="amount">Total Received</th>
                <th>Time</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>
<script>
    const DATA_URL = 'https://raw.githubusercontent.com/patchcoin/claims-made/refs/heads/main/claims.json';
    const CAP = 21000000;
    const userLocale = navigator.language || 'en-US';

    let chart;

    function formatNumber(num) {
        return new Intl.NumberFormat(userLocale).format(num);
    }

    function formatAmount(num) {
        return new Intl.NumberFormat(userLocale, { minimumFractionDigits: 6, maximumFractionDigits: 6 }).format(num);
    }

    function createTooltipHtml(context) {
        if (!context[0]) return '';
        const idx = context[0].dataIndex;
        const claim = window.sortedClaims[idx];
        if (!claim) return '';
        return `
        <div class="chart-tooltip">
          <div style="font-weight: 600; margin-bottom: 8px;">${context[0].label}</div>
          <div style="color: ${context[0].dataset.borderColor};">
            ${context[0].dataset.label}: ${formatAmount(context[0].parsed.y)}
          </div>
          <div style="margin-top: 8px;">
            <div class="truncate">Peercoin: ${claim.peercoin_address}</div>
            <div class="truncate">Patchcoin: ${claim.patchcoin_address}</div>
            <div>Balance: ${formatAmount(claim.peercoin_balance)}</div>
          </div>
        </div>
      `;
    }

    async function fetchData() {
        try {
            const response = await fetch(DATA_URL);
            const data = await response.json();
            return data;
        } catch (error) {
            console.error('Error fetching data:', error);
            return [];
        }
    }

    function updateTable(data) {
        const tableBody = document.getElementById('claimsTable').querySelector('tbody');
        tableBody.innerHTML = '';
        data.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
          <td class="truncate">${item.peercoin_address}</td>
          <td class="truncate">${item.patchcoin_address}</td>
          <td class="amount">${formatAmount(item.peercoin_balance)}</td>
          <td class="amount">${formatAmount(item.patchcoin_eligible)}</td>
          <td class="amount">${formatAmount(item.total_received)}</td>
          <td>${new Date(item.nTime * 1000).toLocaleString(userLocale)}</td>
        `;
            tableBody.appendChild(row);
        });
    }

    function filterTable() {
        const filter = document.getElementById('claimsSearch').value.toLowerCase();
        const rows = document.getElementById('claimsTable').querySelectorAll('tbody tr');
        rows.forEach(row => {
            row.style.display = row.innerText.toLowerCase().includes(filter) ? '' : 'none';
        });
    }

    document.getElementById('claimsSearch').addEventListener('input', filterTable);

    async function updateDashboard() {
        const data = await fetchData();
        data.sort((a, b) => a.nTime - b.nTime);
        window.sortedClaims = data;
        const times = [];
        const cumulativeEligible = [];
        const cumulativeReceived = [];
        let totalEligible = 0;
        let totalReceived = 0;
        data.forEach(item => {
            totalEligible += item.patchcoin_eligible;
            cumulativeEligible.push(totalEligible);
            totalReceived += item.total_received;
            cumulativeReceived.push(totalReceived);
            const date = new Date(item.nTime * 1000);
            times.push(date.toLocaleString(userLocale));
        });
        const chartConfig = {
            type: 'line',
            data: {
                labels: times,
                datasets: [
                    {
                        label: 'Cumulative Eligible',
                        data: cumulativeEligible,
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 2
                    },
                    {
                        label: 'Cumulative Received',
                        data: cumulativeReceived,
                        borderColor: '#16a34a',
                        backgroundColor: 'rgba(22, 163, 74, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 2
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                scales: {
                    x: {
                        grid: { display: false },
                        ticks: {
                            maxTicksLimit: window.innerWidth < 768 ? 5 : 10,
                            maxRotation: 45,
                            minRotation: 45
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(0, 0, 0, 0.1)' },
                        ticks: {
                            callback: (value) => formatAmount(value)
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        enabled: false,
                        external: function(context) {
                            const tooltipEl = document.getElementById('chartjs-tooltip') || (() => {
                                const div = document.createElement('div');
                                div.id = 'chartjs-tooltip';
                                document.body.appendChild(div);
                                return div;
                            })();
                            const tooltipModel = context.tooltip;
                            if (tooltipModel.opacity === 0) {
                                tooltipEl.style.opacity = 0;
                                return;
                            }
                            tooltipEl.innerHTML = createTooltipHtml(tooltipModel.dataPoints);
                            const position = context.chart.canvas.getBoundingClientRect();
                            tooltipEl.style.position = 'absolute';
                            tooltipEl.style.left = position.left + window.pageXOffset + tooltipModel.caretX + 'px';
                            tooltipEl.style.top = position.top + window.pageYOffset + tooltipModel.caretY + 'px';
                            tooltipEl.style.opacity = 1;
                            tooltipEl.style.pointerEvents = 'none';
                        }
                    },
                    legend: {
                        labels: {
                            usePointStyle: true,
                            padding: 20
                        }
                    }
                }
            }
        };
        if (chart) { chart.destroy(); }
        const ctx = document.getElementById('claimsChart').getContext('2d');
        chart = new Chart(ctx, chartConfig);
        const eligiblePercent = Math.min((totalEligible / CAP) * 100, 100);
        const receivedPercent = Math.min((totalReceived / CAP) * 100, 100);
        document.getElementById('capProgressEligible').style.width = eligiblePercent + '%';
        document.getElementById('capProgressReceived').style.width = receivedPercent + '%';
        document.getElementById('eligiblePercent').textContent = eligiblePercent.toFixed(2) + '%';
        document.getElementById('receivedPercent').textContent = receivedPercent.toFixed(2) + '%';
        document.getElementById('eligibleSubtitle').textContent =
            `${formatAmount(totalEligible)} / ${formatAmount(CAP)}`;
        document.getElementById('receivedSubtitle').textContent =
            `${formatAmount(totalReceived)} / ${formatAmount(CAP)}`;
        updateTable(data);
    }

    updateDashboard();
    setInterval(updateDashboard, 60000);
    window.addEventListener('resize', () => {
        if (chart) { chart.resize(); }
    });
</script>
</body>
</html>

